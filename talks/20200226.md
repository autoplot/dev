I need a place to put notes for the upcoming talk on Autoplot scripting at Iowa.  Ivar suggested picking three scripts and
going through them.  

Meeting with Masafumi, we decided on several things.  First, there should be three levels of comfort (beginner, intermediate, expert).  Second, the plot command needs a whole page describing its use.  The page in documentation should link to this.  The ten or so commands are what an intermediate person knows, and they know where to look stuff up.  Third, the plot command has an overplot keyword, and this should be used instead of plot position.  Bonus: there might be a special Jython command for adding decorators without having to specify a class.

# Autoplot Scripts 
* "Compact" store of business function
  * One file, one action, for example "Digitize Juno Data" or "Show Voyager Low-Rate".
  * Can easily be moved and interpretted out-of-context.  (Attached to an email)
* easily-generated controls
  * getParam function used instead of method with parameters.
  * one line per parameter
  * default value is encouraged, to help with discovery.
  * one-line label is encouraged.
  * constraints on values, enumerations, and examples
* easy-generated interface
  * setScriptTitle is a one-line title
  * setScriptDescription allows a paragraph-length description
* Note this means I can use the spec to create other interfaces
  * unix% autoplot --script=myscript.jy scriptArgA=1 scriptArgB=3
  * https://jfaden.net/AutoplotServlet/ScriptGUIServlet
* Jython used, with additional methods automatically imported.

# What can be done with a script
* Quick calculations.  Have B, want FCE,  http://emfisis.physics.uiowa.edu/pub/jyds/fce_A_4sec_L3.jyds
* Data operations.  Show one variable only when another is big,  http://emfisis.physics.uiowa.edu/pub/jyds/filterParm.jyds
* Custom plots, https://abbith.physics.uiowa.edu/jbf/juno/blob/master/u/masafumi/2020/20200225/JunoWigglePlotForSadie.jy
* Science Workflows, https://abbith.physics.uiowa.edu/jbf/juno/blob/master/u/doug/2020/20200221/upDownDigitizer.jy

# SVN 
* SVN allows teams to work on a common code base, merging their work together.
* SVN was used for years (and still is) for managing scripts.  
* We would make changes in a "local working copy" and then commit them to the server.
* The scientists would then run scripts from a web site.

# GitHub
* Git is like SVN, but is newer and maybe more flexible (and complex).  Like Object Oriented Programming, it's hard for people used to SVN but not so hard for new people.
* There's a clear "center" where everything is stored.
* GitHub is site set up years ago, and anyone can store files there.
* It is a Git, but it also adds a web interface to the files, and you can edit files right on the site.
* Since GitHub is set up already and freely available, it's great place for anyone to start using.
* Autoplot can interface with GitHub as well, knowing the tricks to get raw files.

# GitLabs
* GitHub is just one instance of GitLabs, which is free software. 
* Any workgroup can set up a GitLabs instance, like:
  * http://abbith.physics.uiowa.edu,  Radio and Plasma Waves Group instance.
  * http://git.uiowa.edu, University of Iowa instance.
  * http://jfaden.net/git, My instance at home.
* Autoplot needs to recognize a GitLabs instance, and this is presently hard-coded.  TO-BE-DONE
* Autoplot can only use public projects.  Another TO-BE-DONE is to allow private projects.

# Other nice features of GitLabs
* Markdown is built in.  Any ".md" file is displayed using a MarkDown renderer.
  * Headings, Lists, Paragraphs 
  * Tables
  * Images
  * LaTeX
* Markdown should be sufficient for writing nice documentation and making notes.
* Also markdown is intended to look descent when the raw HTML is displayed.  In 50 years, documentation still "works."
* Built-in search engine
* History -- you can get to and run old script versions.
* Issue tracking
* readme.md is automatically displayed.

# Questions for GitLabs Management
* I've been using GitLabs for writing scripts for people for about 6 months, I'd like to get this "right."
* Duplicate copies of scripts.
* I'll write an ad-hoc script for some study and send a link to a scientist.
* Before long, other scientists are using it
* I'd suggest there are some scripts which should be a well-tested and reliable resource we can all use.
* How do we know when this is the case?
* The ad-hoc version could point to the new version.

# New script documentation coming
* Autoplot's scripting documentation is at http://www-pw.physics.uiowa.edu/~jbf/autoplot/javadoc2018/
* This is "JavaDoc"--automatic documentation for Java code.
* It works by convention, where documentation within the code is converted to a website with the JavaDoc tool.
* Since Autoplot's Jython is really just calling Java codes, this works for documentation.
* But--it's inefficient, and unaware that Jython is use for it, and optimizations made.
* Also, the built-in script editor can render html, but new versions of JavaDoc make HTML which don't render well.
* JavaDoc allows extention, and I've been working to make an extension to make documentation geared towards Jython use.
* http://www-pw.physics.uiowa.edu/~jbf/autoplot/doc/ will appear nicely in the popup editor, and will include links
to GitHub and the Java source code.

# Using scripts
* setScriptTitle and setScriptDescription make the GUI.
* what's happening.  Autoplot downloads the script and passes the local filename to the Jython interpretter.
  * what's really happening is Autoplot checks timestamps on files and hashes to see if new version must be downloaded.
  * Note there's some odd bug between Java's caching of GitHub which means Autoplot doesn't automatically get the file, it needs about a minute to pass before the change will propagate.
  * Our GitLabs installations don't have this problem.
* Use case: Sadie needed a particular version of Masafumi's plot.  Masafumi copies his script on to GitLabs, makes the change and then points her to the version.

# .jy vs .jyds scripts
* .jy is application-level scripts.
* .jyds can only access data stuff.  (Should be secure.)

# Jython vs. Python Scripts
* Jython doesn't have access to many Python libraries
* Jython is Python 2.2.  Upgrading to 2.7, but this has lots of problems (download size, migration to 3).
* Jython 2.7 is supposed to work with Python 2.7 libraries and SciPy, but I haven't looked at this deeply.
* Jython 3.6 is coming, but Jython 2.7 was coming for years as well.
* Few developers, not a healthy project (no appearent corporate backers, etc).
* But of course for the same reasons 2.2 was popular with scientists, it's still useful here.

# Basic Script
~~~~~
mag= getDataSet('vap+cdf:http://emfisis.physics.uiowa.edu/Flight/RBSP-A/L3/$Y/$m/$d/rbsp-a_magnetometer_4sec-gei_emfisis-L3_$Y$m$d_v$(v,sep).cdf?timerange=2019-01-01&Magnitude')
fce= mag*28
plot( fce, ytitle='FCE' )
~~~~~

# Autoplot DOM
* the "DOM" is the application state.  Every Autoplot instance has one.
* When you say "plot" you are modifying the DOM.

# Using Logging
* I do lots of "print x" commands to see what's going on
* logger.fine("x") is nice because you can turn off the logger when you are done debugging.
* Autoplot uses logging throughout.  Some example channels are:
  * jython.script logs all getDataSet calls at Level.FINE.
  * das2.url logs all web connections.
  
# Levels of Expertise - "Basic"
* sequence of commands to load and plot data.
* can use plot command documentation to get very custom plot.
* setScriptTitle, setScriptDocumetation, getParam.
* does not instantiate classes like DataSetBuilder.
* comfortable with Jython string manipulation.

# Levels of Expertise - "Intermediate"
* comfortable using the dom object.
* comfortable with the monitor.
* uses other pre-imported classes like DataSetBuilder
* uses def methods to make code more readable.
* uses def to define callbacks like invokeLater, addTopDecoration.
* imports remote .jy codes for use.
* comforable with digging around classes to find methods.
* write a pure-jython GUI which handles callbacks with button press.

# Levels of Expertise - "Expert"
* comfortable with callbacks
* writes Jython classes, such as renderers.
* imports Java codes to use for arbitrary tasks.
* imports remote .jar file libraries for use.

# Operator Overloading, SciPy and IDL-like operations
* if A is a dataset and B is a dataset, then C=A+B is a dataset where Ci=Ai+Bi for each i
* The common operators work like this, * / + -, ** is pow.
* Note arguments are "promoted" to work, so fce=mag*28 works by multiplying each element of mag by 28.

# Jython Strings
* Jython (and Python) has interesting string manipulation
* '%s %d' % ( s,d ) will plug in the string s into %s and the integer d into %d.
* for filenames you might use: 'rbsp_%s_%04d%02d%02d' % ( sc, Y, M, d )
* often you will see a combination of Autoplot's aggregation strings and this: 'rbsp_%s_$Y$m$d' % sc
